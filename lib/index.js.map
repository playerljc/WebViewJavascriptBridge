{"version":3,"file":"index.js","sources":["index.js"],"sourcesContent":["/**\r\n * 浏览器端对bridge缺省的实现\r\n */\r\nvar DEFAULT_BROWSER_BRIDGE_IMPL = {\r\n    callHandler: function (method, params, callback) {\r\n        callback();\r\n    },\r\n    /**\r\n     * registerHandler\r\n     * @param method - 方法名称\r\n     * @param callback - 回调函数\r\n     */\r\n    registerHandler: function (method, callback) { },\r\n};\r\n/**\r\n * setupiOSWebViewJavascriptBridge - 设置iOS的WebViewJavascriptBridge\r\n * @returns {Number}\r\n */\r\nfunction setupiOSWebViewJavascriptBridge(callback) {\r\n    // @ts-ignore\r\n    if (window.WebViewJavascriptBridge) {\r\n        // @ts-ignore\r\n        return callback(window.WebViewJavascriptBridge);\r\n    }\r\n    // @ts-ignore\r\n    if (window.WVJBCallbacks) {\r\n        // @ts-ignore\r\n        return window.WVJBCallbacks.push(callback);\r\n    }\r\n    // @ts-ignore\r\n    window.WVJBCallbacks = [callback];\r\n    var WVJBIframe = document.createElement('iframe');\r\n    WVJBIframe.style.display = 'none';\r\n    WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';\r\n    document.documentElement.appendChild(WVJBIframe);\r\n    setTimeout(function () {\r\n        document.documentElement.removeChild(WVJBIframe);\r\n    }, 0);\r\n}\r\n/**\r\n * WebViewJavascriptBridge - 设置Android的WebViewJavascriptBridge\r\n */\r\nfunction setupAndroidWebViewJavascriptBridge(callback) {\r\n    // @ts-ignore\r\n    if (window.WebViewJavascriptBridge) {\r\n        // @ts-ignore\r\n        callback(window.WebViewJavascriptBridge);\r\n    }\r\n    else {\r\n        document.addEventListener('WebViewJavascriptBridgeReady', function () {\r\n            // @ts-ignore\r\n            callback(window.WebViewJavascriptBridge);\r\n        }, false);\r\n    }\r\n}\r\n/**\r\n * setupWebViewJavascriptBridge\r\n * @param browserBridgeImpl - 客户端对bridge的实现\r\n */\r\nexport default (function (browserBridgeImpl) {\r\n    // @ts-ignore\r\n    return new Promise(function (resolve) {\r\n        var platform = document.documentElement.getAttribute('platform') || 'browser';\r\n        // @ts-ignore\r\n        window.$platform = platform;\r\n        // iOS端\r\n        if (platform === 'iOS') {\r\n            setupiOSWebViewJavascriptBridge(function (bridge) {\r\n                // @ts-ignore\r\n                window.$bridge = bridge;\r\n                // @ts-ignore\r\n                resolve(window.$bridge);\r\n            });\r\n        }\r\n        // Android端\r\n        else if (platform === 'Android') {\r\n            setupAndroidWebViewJavascriptBridge(function (bridge) {\r\n                // @ts-ignore\r\n                window.$bridge = bridge;\r\n                // @ts-ignore\r\n                window.$bridge.init(function (message, responseCallback) { });\r\n                // @ts-ignore\r\n                resolve(window.$bridge);\r\n            });\r\n        }\r\n        // 浏览器端\r\n        else if (platform === 'browser') {\r\n            // @ts-ignore\r\n            window.$bridge = browserBridgeImpl || DEFAULT_BROWSER_BRIDGE_IMPL;\r\n            // @ts-ignore\r\n            resolve(window.$bridge);\r\n        }\r\n    });\r\n});\r\n"],"names":["DEFAULT_BROWSER_BRIDGE_IMPL","callHandler","method","params","callback","registerHandler","setupiOSWebViewJavascriptBridge","window","WebViewJavascriptBridge","WVJBCallbacks","push","WVJBIframe","document","createElement","style","display","src","documentElement","appendChild","setTimeout","removeChild","setupAndroidWebViewJavascriptBridge","addEventListener","browserBridgeImpl","Promise","resolve","platform","getAttribute","$platform","bridge","$bridge","init","message","responseCallback"],"mappings":"AAGA,IAAIA,4BAA8B,CAC9BC,YAAa,SAAUC,EAAQC,EAAQC,GACnCA,KAOJC,gBAAiB,SAAUH,EAAQE,MAMvC,SAASE,gCAAgCF,GAErC,GAAIG,OAAOC,wBAEP,OAAOJ,EAASG,OAAOC,yBAG3B,GAAID,OAAOE,cAEP,OAAOF,OAAOE,cAAcC,KAAKN,GAGrCG,OAAOE,cAAgB,CAACL,GACxB,IAAIO,EAAaC,SAASC,cAAc,UACxCF,EAAWG,MAAMC,QAAU,OAC3BJ,EAAWK,IAAM,iCACjBJ,SAASK,gBAAgBC,YAAYP,GACrCQ,WAAW,WACPP,SAASK,gBAAgBG,YAAYT,IACtC,GAKP,SAASU,oCAAoCjB,GAErCG,OAAOC,wBAEPJ,EAASG,OAAOC,yBAGhBI,SAASU,iBAAiB,+BAAgC,WAEtDlB,EAASG,OAAOC,2BACjB,kBAOI,SAAWe,GAEtB,OAAO,IAAIC,QAAQ,SAAUC,GACzB,IAAIC,EAAWd,SAASK,gBAAgBU,aAAa,aAAe,UAInD,SAFjBpB,OAAOqB,UAAYF,GAGfpB,gCAAgC,SAAUuB,GAEtCtB,OAAOuB,QAAUD,EAEjBJ,EAAQlB,OAAOuB,WAID,YAAbJ,EACLL,oCAAoC,SAAUQ,GAE1CtB,OAAOuB,QAAUD,EAEjBtB,OAAOuB,QAAQC,KAAK,SAAUC,EAASC,MAEvCR,EAAQlB,OAAOuB,WAID,YAAbJ,IAELnB,OAAOuB,QAAUP,GAAqBvB,4BAEtCyB,EAAQlB,OAAOuB"}